popoto=function(){var a={version:"0.0-a1",start:function(b){a.logger.info("Popoto "+a.version+" start.");"undefined"==typeof a.rest.CYPHER_URL?a.logger.error("popoto.rest.CYPHER_URL is not set but this property is required."):(a.checkHtmlComponents(),a.taxonomy.isActive&&a.taxonomy.createTaxonomyPanel(),a.graph.isActive&&(a.graph.createGraphArea(),a.graph.createForceLayout(),a.graph.addRootNode(b)),a.queryviewer.isActive&&a.queryviewer.createQueryArea(),a.update())},checkHtmlComponents:function(){var b=
d3.select("#"+a.graph.containerId),c=d3.select("#"+a.taxonomy.containerId),d=d3.select("#"+a.queryviewer.containerId),e=d3.select("#"+a.cypherviewer.containerId),f=d3.select("#"+a.result.containerId);b.empty()?(a.logger.debug("The page doesn't contain a container with ID = \""+a.graph.containerId+'" no graph area will be generated. This ID is defined in popoto.graph.containerId property.'),a.graph.isActive=!1):a.graph.isActive=!0;c.empty()?(a.logger.debug("The page doesn't contain a container with ID = \""+
a.taxonomy.containerId+'" no taxonomy filter will be generated. This ID is defined in popoto.taxonomy.containerId property.'),a.taxonomy.isActive=!1):a.taxonomy.isActive=!0;d.empty()?(a.logger.debug("The page doesn't contain a container with ID = \""+a.queryviewer.containerId+'" no query viewer will be generated. This ID is defined in popoto.queryviewer.containerId property.'),a.queryviewer.isActive=!1):a.queryviewer.isActive=!0;e.empty()?(a.logger.debug("The page doesn't contain a container with ID = \""+
a.cypherviewer.containerId+'" no cypher query viewer will be generated. This ID is defined in popoto.cypherviewer.containerId property.'),a.cypherviewer.isActive=!1):a.cypherviewer.isActive=!0;f.empty()?(a.logger.debug("The page doesn't contain a container with ID = \""+a.result.containerId+'" no result area will be generated. This ID is defined in popoto.result.containerId property.'),a.result.isActive=!1):a.result.isActive=!0},update:function(){a.graph.isActive&&(a.graph.force.start(),a.graph.link.updateLinks(),
a.graph.node.updateNodes());a.queryviewer.isActive&&a.queryviewer.updateQuery();(a.result.isActive||0<a.result.resultListeners.length||0<a.result.resultCountListeners.length)&&a.result.updateResults()},rest:{}};a.rest.CYPHER_URL="http://localhost:7474/db/data/cypher";a.logger={};a.logger.LogLevels=Object.freeze({DEBUG:0,INFO:1,WARN:2,ERROR:3,NONE:4});a.logger.LEVEL=a.logger.LogLevels.NONE;a.logger.TRACE=!1;a.logger.log=function(b,c){if(console&&b>=a.logger.LEVEL)switch(a.logger.TRACE&&(c=c+"\n"+Error().stack),
b){case a.logger.LogLevels.DEBUG:console.log(c);break;case a.logger.LogLevels.INFO:console.log(c);break;case a.logger.LogLevels.WARN:console.warn(c);break;case a.logger.LogLevels.ERROR:console.error(c)}};a.logger.debug=function(b){a.logger.log(a.logger.LogLevels.DEBUG,b)};a.logger.info=function(b){a.logger.log(a.logger.LogLevels.INFO,b)};a.logger.warn=function(b){a.logger.log(a.logger.LogLevels.WARN,b)};a.logger.error=function(b){a.logger.log(a.logger.LogLevels.ERROR,b)};a.taxonomy={};a.taxonomy.containerId=
"popoto-taxonomy";a.taxonomy.createTaxonomyPanel=function(){var b=d3.select("#"+a.taxonomy.containerId).append("ul"),c=a.taxonomy.generateTaxonomiesData(),b=b.selectAll(".taxo").data(c).enter().append("li").attr("id",function(a){return a.id}).attr("value",function(a){return a.label});b.append("img").attr("src","css/image/category.png").attr("width","24").attr("height","24");b.append("span").attr("class","ppt-label").text(function(a){return a.label});b.append("span").attr("class","ppt-count");b.on("click",
function(b){d3.event.stopPropagation();for(b=this.attributes.value.value;0<a.graph.force.nodes().length;)a.graph.force.nodes().pop();for(;0<a.graph.force.links().length;)a.graph.force.links().pop();a.graph.node.internalLabels={};a.update();a.graph.addRootNode(b);a.graph.hasGraphChanged=!0;a.result.hasChanged=!0;a.update()});a.taxonomy.addTaxonomyChildren(b);var d=[];c.forEach(function(b){d.push(b);b.children&&a.taxonomy.flattenChildren(b,d)});d.forEach(function(b){a.taxonomy.updateCount(b)})};a.taxonomy.flattenChildren=
function(b,c){b.children.forEach(function(b){c.push(b);b.children&&c.concat(a.taxonomy.flattenChildren(b,c))})};a.taxonomy.updateCount=function(b){var c=a.query.generateTaxonomyCountQuery(b.label);a.logger.info("Label count query ==> "+c);(function(b){$.post(a.rest.CYPHER_URL,{query:c,params:{}},"json").done(function(a){a=a.data[0][0];d3.select("#"+b.id).select(".ppt-count").text(" ("+a+")")}).fail(function(c,f,h){a.logger.error(f+': error while accessing Neo4j server on URL:"'+a.rest.CYPHER_URL+
'" defined in "popoto.rest.CYPHER_URL" property: '+h);d3.select("#"+b.id).select(".ppt-count").text(" (0)")})})(b)};a.taxonomy.addTaxonomyChildren=function(b){b.each(function(b){var d=d3.select(this),e=b.children;b.children&&(b=d.append("ul").selectAll("li").data(e).enter().append("li").attr("id",function(a){return a.id}).attr("value",function(a){return a.label}),b.append("img").attr("src","css/image/category.png").attr("width","24").attr("height","24"),b.append("span").attr("class","ppt-label").text(function(a){return a.label}),
b.append("span").attr("class","ppt-count"),b.on("click",function(b){d3.event.stopPropagation();for(b=this.attributes.value.value;0<a.graph.force.nodes().length;)a.graph.force.nodes().pop();for(;0<a.graph.force.links().length;)a.graph.force.links().pop();a.graph.node.internalLabels={};a.update();a.graph.addRootNode(b);a.graph.hasGraphChanged=!0;a.result.hasChanged=!0;a.update()}),a.taxonomy.addTaxonomyChildren(b))})};a.taxonomy.generateTaxonomiesData=function(){var b=0,c=[],d;for(d in a.provider.nodeProviders)a.provider.nodeProviders.hasOwnProperty(d)&&
a.provider.getProperty(d,"isSearchable")&&!a.provider.nodeProviders[d].parent&&c.push({label:d,id:"popoto-lbl-"+b++});c.forEach(function(c){a.provider.getProvider(c.label).hasOwnProperty("children")&&(b=a.taxonomy.addChildrenData(c,b))});return c};a.taxonomy.addChildrenData=function(b,c){b.children=[];a.provider.getProvider(b.label).children.forEach(function(d){var e=a.provider.getProvider(d),f={label:d,id:"popoto-lbl-"+c++};e.hasOwnProperty("children")&&(c=a.taxonomy.addChildrenData(f,c));a.provider.getProperty(d,
"isSearchable")&&b.children.push(f)});return c};a.tools={};a.tools.center=function(){a.graph.zoom.translate([0,0]).scale(1);a.graph.svg.transition().attr("transform","translate("+a.graph.zoom.translate()+") scale("+a.graph.zoom.scale()+")")};a.tools.toggleTaxonomy=function(){var b=d3.select("#"+a.taxonomy.containerId);b.filter(".disabled").empty()?b.classed("disabled",!0):b.classed("disabled",!1)};a.tools.toggleFullScreen=function(){var b=document.getElementById(a.graph.containerId);document.fullscreenElement||
document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():b.requestFullscreen?b.requestFullscreen():b.msRequestFullscreen?b.msRequestFullscreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullscreen&&b.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)};
a.graph={};a.graph.containerId="popoto-graph";a.graph.hasGraphChanged=!0;a.graph.zoom=d3.behavior.zoom().scaleExtent([.1,10]);a.graph.createGraphArea=function(){var b=d3.select("#"+a.graph.containerId),c=b.append("div").attr("class","ppt-toolbar");if(a.taxonomy.isActive)c.append("span").attr("id","popoto-taxonomy-menu").attr("class","ppt-menu taxonomy").attr("title","Show/hide taxonomy panel").on("click",a.tools.toggleTaxonomy);c.append("span").attr("id","popoto-center-menu").attr("class","ppt-menu center").attr("title",
"Center view").on("click",a.tools.center);c.append("span").attr("id","popoto-fullscreen-menu").attr("class","ppt-menu fullscreen").attr("title","Full screen").on("click",a.tools.toggleFullScreen);a.graph.svg=b.append("svg").call(a.graph.zoom.on("zoom",a.graph.rescale)).on("dblclick.zoom",null).attr("class","ppt-svg-graph").append("svg:g");a.graph.svg.append("g").attr("id",a.graph.link.gID);a.graph.svg.append("g").attr("id",a.graph.node.gID);window.addEventListener("resize",function(){a.graph.getRootNode().px=
a.graph.getSVGWidth()/2;a.graph.getRootNode().py=a.graph.getSVGHeight()/2;a.update()})};a.graph.getSVGWidth=function(){return"undefined"==typeof a.graph.svg||a.graph.svg.empty()?(a.logger.debug("popoto.graph.svg is undefined or empty."),0):document.getElementById(a.graph.containerId).clientWidth};a.graph.getSVGHeight=function(){return"undefined"==typeof a.graph.svg||a.graph.svg.empty()?(a.logger.debug("popoto.graph.svg is undefined or empty."),0):document.getElementById(a.graph.containerId).clientHeight};
a.graph.rescale=function(){a.graph.svg.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")};a.graph.LINK_DISTANCE=150;a.graph.LINK_STRENGTH=1;a.graph.FRICTION=.8;a.graph.CHARGE=-1400;a.graph.THETA=.8;a.graph.GRAVITY=0;a.graph.createForceLayout=function(){a.graph.force=d3.layout.force().size([a.graph.getSVGWidth(),a.graph.getSVGHeight()]).linkDistance(function(b){return b.type===a.graph.link.LinkTypes.RELATION?3*a.graph.LINK_DISTANCE/2:a.graph.LINK_DISTANCE}).linkStrength(function(b){return b.linkStrength?
b.linkStrength:a.graph.LINK_STRENGTH}).friction(a.graph.FRICTION).charge(function(b){return b.charge?b.charge:a.graph.CHARGE}).theta(a.graph.THETA).gravity(a.graph.GRAVITY).on("tick",a.graph.tick);a.graph.force.drag().on("dragstart",function(a){d3.event.sourceEvent.stopPropagation()}).on("dragend",function(a){d3.event.sourceEvent.stopPropagation()})};a.graph.addRootNode=function(b){0<a.graph.force.nodes().length&&a.logger.debug("popoto.graph.addRootNode is called but the graph is not empty.");a.graph.force.nodes().push({id:"0",
type:a.graph.node.NodeTypes.ROOT,x:a.graph.getSVGWidth()/2,y:a.graph.getSVGHeight()/2,label:b,fixed:!0,internalLabel:a.graph.node.generateInternalLabel(b)})};a.graph.getRootNode=function(){return a.graph.force.nodes()[0]};a.graph.tick=function(){a.graph.svg.selectAll("#"+a.graph.link.gID+" > g").selectAll("path").attr("d",function(a){return a.source.x<=a.target.x?"M"+a.source.x+" "+a.source.y+"L"+a.target.x+" "+a.target.y:"M"+a.target.x+" "+a.target.y+"L"+a.source.x+" "+a.source.y});a.graph.svg.selectAll("#"+
a.graph.node.gID+" > g").attr("transform",function(a){return"translate("+a.x+","+a.y+")"})};a.graph.link={};a.graph.link.gID="popoto-glinks";a.graph.link.LinkTypes=Object.freeze({RELATION:0,VALUE:1});a.graph.link.updateLinks=function(){a.graph.link.svgLinkElements=a.graph.svg.select("#"+a.graph.link.gID).selectAll("g");a.graph.link.updateData();a.graph.link.removeElements();a.graph.link.addNewElements();a.graph.link.updateElements()};a.graph.link.updateData=function(){a.graph.link.svgLinkElements=
a.graph.link.svgLinkElements.data(a.graph.force.links(),function(a){return a.id})};a.graph.link.removeElements=function(){a.graph.link.svgLinkElements.exit().remove()};a.graph.link.addNewElements=function(){var b=a.graph.link.svgLinkElements.enter().append("g").attr("class","ppt-glink").on("mouseover",a.graph.link.mouseOverLink).on("mouseout",a.graph.link.mouseOutLink);b.append("path");b.append("text").attr("text-anchor","middle").attr("dy","-4").append("textPath").attr("class","ppt-textPath").attr("startOffset",
"50%")};a.graph.link.updateElements=function(){a.graph.link.svgLinkElements.attr("id",function(a){return"ppt-glink_"+a.id});a.graph.link.svgLinkElements.selectAll("path").attr("id",function(a){return"ppt-path_"+a.id}).attr("class",function(b){return b.type===a.graph.link.LinkTypes.VALUE?"ppt-link-value":"ppt-link-relation"});a.graph.link.svgLinkElements.selectAll("text").attr("id",function(a){return"ppt-text_"+a.id}).attr("class",function(b){return b.type===a.graph.link.LinkTypes.VALUE?"ppt-link-text-value":
"ppt-link-text-relation"}).selectAll(".ppt-textPath").attr("id",function(a){return"ppt-textpath_"+a.id}).attr("xlink:href",function(a){return"#ppt-path_"+a.id}).text(function(b){return a.provider.getLinkTextValue(b)})};a.graph.link.mouseOverLink=function(){d3.select(this).select("path").classed("ppt-link-hover",!0);d3.select(this).select("text").classed("ppt-link-hover",!0);if(a.queryviewer.isActive){var b=d3.select(this).data()[0];a.queryviewer.queryConstraintSpanElements.filter(function(a){return a.ref===
b}).classed("hover",!0);a.queryviewer.querySpanElements.filter(function(a){return a.ref===b}).classed("hover",!0)}};a.graph.link.mouseOutLink=function(){d3.select(this).select("path").classed("ppt-link-hover",!1);d3.select(this).select("text").classed("ppt-link-hover",!1);if(a.queryviewer.isActive){var b=d3.select(this).data()[0];a.queryviewer.queryConstraintSpanElements.filter(function(a){return a.ref===b}).classed("hover",!1);a.queryviewer.querySpanElements.filter(function(a){return a.ref===b}).classed("hover",
!1)}};a.graph.node={};a.graph.node.gID="popoto-gnodes";a.graph.node.ELLIPSE_RX=50;a.graph.node.ELLIPSE_RY=25;a.graph.node.NODE_MAX_CHARS=11;a.graph.node.PAGE_SIZE=10;a.graph.node.CountBox={x:16,y:33,w:52,h:19};a.graph.node.chooseWaiting=!1;a.graph.node.NodeTypes=Object.freeze({ROOT:0,CHOOSE:1,VALUE:2,GROUP:3});a.graph.node.idgen=0;a.graph.node.internalLabels={};a.graph.node.generateInternalLabel=function(b){b=b.toLowerCase().replace(/ /g,"");if(b in a.graph.node.internalLabels)a.graph.node.internalLabels[b]+=
1;else return a.graph.node.internalLabels[b]=0,b;return b+a.graph.node.internalLabels[b]};a.graph.node.updateNodes=function(){a.graph.node.svgNodeElements||(a.graph.node.svgNodeElements=a.graph.svg.select("#"+a.graph.node.gID).selectAll("g"));a.graph.node.updateData();a.graph.node.removeElements();a.graph.node.addNewElements();a.graph.node.updateElements()};a.graph.node.updateData=function(){a.graph.node.svgNodeElements=a.graph.node.svgNodeElements.data(a.graph.force.nodes(),function(a){return a.id});
a.graph.hasGraphChanged&&(a.graph.node.updateCount(),a.graph.hasGraphChanged=!1)};a.graph.node.updateCount=function(){a.graph.force.nodes().filter(function(b){return b.type!==a.graph.node.NodeTypes.VALUE&&b.type!==a.graph.node.NodeTypes.GROUP}).forEach(function(b){var c=a.query.generateNodeCountCypherQuery(b);a.logger.info("Count ("+b.label+") ==> "+c);$.post(a.rest.CYPHER_URL,{query:c,params:{}},"json").done(function(c){b.count=c.data[0][0];a.graph.node.updateForegroundElements()}).fail(function(c,
e,f){a.logger.error(e+': error while accessing Neo4j server on URL:"'+a.rest.CYPHER_URL+'" defined in "popoto.rest.CYPHER_URL" property: '+f);b.count=0;a.graph.node.updateForegroundElements()})})};a.graph.node.removeElements=function(){var b=a.graph.node.svgNodeElements.exit();b.filter(function(a){return!a.parent}).remove();b.filter(function(a){return a.parent}).transition().duration(300).attr("transform",function(a){return"translate("+a.parent.x+","+a.parent.y+")"}).remove()};a.graph.node.addNewElements=
function(){var b=a.graph.node.svgNodeElements.enter().append("g").on("click",a.graph.node.nodeClick);b.filter(function(b){return b.type!==a.graph.node.NodeTypes.VALUE}).on("contextmenu",a.graph.node.rightClickNode).on("mouseover",a.graph.node.mouseOverNode).on("mouseout",a.graph.node.mouseOutNode);b.filter(function(b){return b.type===a.graph.node.NodeTypes.VALUE}).on("contextmenu",function(){d3.event.preventDefault()});b.append("title");a.graph.node.addBackgroundElements(b);a.graph.node.addMiddlegroundElements(b);
a.graph.node.addForegroundElements(b)};a.graph.node.addBackgroundElements=function(a){a.append("g").attr("class","ppt-g-node-background").append("circle").attr("class","ppt-node-background-circle").style("fill-opacity",0).attr("r",70)};a.graph.node.addMiddlegroundElements=function(b){b=b.append("g").attr("class","ppt-g-node-middleground");b.filter(function(b){return a.provider.getNodeDisplayType(b)===a.provider.NodeDisplayTypes.IMAGE}).append("image").attr("class","ppt-node-image");b.filter(function(b){return a.provider.getNodeDisplayType(b)===
a.provider.NodeDisplayTypes.SVG}).append("g");b.filter(function(b){return a.provider.getNodeDisplayType(b)===a.provider.NodeDisplayTypes.TEXT}).append("ellipse").attr("rx",a.graph.node.ELLIPSE_RX).attr("ry",a.graph.node.ELLIPSE_RY);b.filter(function(b){return a.provider.isTextDisplayed(b)}).append("text").attr("x",0).attr("y",8).attr("text-anchor","middle")};a.graph.node.addForegroundElements=function(b){b=b.append("g").attr("class","ppt-g-node-foreground");var c=b.filter(function(b){return b.type===
a.graph.node.NodeTypes.ROOT||b.type===a.graph.node.NodeTypes.CHOOSE}).append("g").attr("class","ppt-node-foreground-g-arrows"),d=c.append("g");d.append("circle").attr("class","ppt-larrow").attr("cx","-43").attr("cy","-23").attr("r","17");d.append("path").attr("class","ppt-arrow").attr("d","m -44.905361,-23 6.742,-6.742 c 0.81,-0.809 0.81,-2.135 0,-2.944 l -0.737,-0.737 c -0.81,-0.811 -2.135,-0.811 -2.945,0 l -8.835,8.835 c -0.435,0.434 -0.628,1.017 -0.597,1.589 -0.031,0.571 0.162,1.154 0.597,1.588 l 8.835,8.834 c 0.81,0.811 2.135,0.811 2.945,0 l 0.737,-0.737 c 0.81,-0.808 0.81,-2.134 0,-2.943 l -6.742,-6.743 z");
d.on("click",function(b){d3.event.stopPropagation();1<b.page&&(b.page--,a.graph.node.collapseNode(b),a.graph.node.expandNode(b))});c=c.append("g");c.append("circle").attr("class","ppt-rarrow").attr("cx","43").attr("cy","-23").attr("r","17");c.append("path").attr("class","ppt-arrow").attr("d","m 51.027875,-24.5875 -8.835,-8.835 c -0.811,-0.811 -2.137,-0.811 -2.945,0 l -0.738,0.737 c -0.81,0.81 -0.81,2.136 0,2.944 l 6.742,6.742 -6.742,6.742 c -0.81,0.81 -0.81,2.136 0,2.943 l 0.737,0.737 c 0.81,0.811 2.136,0.811 2.945,0 l 8.835,-8.836 c 0.435,-0.434 0.628,-1.017 0.597,-1.588 0.032,-0.569 -0.161,-1.152 -0.596,-1.586 z");
c.on("click",function(b){d3.event.stopPropagation();b.page*a.graph.node.PAGE_SIZE<b.count&&(b.page++,a.graph.node.collapseNode(b),a.graph.node.expandNode(b))});b=b.filter(function(b){return b.type!==a.graph.node.NodeTypes.GROUP});b.append("rect").attr("x",a.graph.node.CountBox.x).attr("y",a.graph.node.CountBox.y).attr("width",a.graph.node.CountBox.w).attr("height",a.graph.node.CountBox.h).attr("class","ppt-count-box");b.append("text").attr("x",42).attr("y",48).attr("text-anchor","middle").attr("class",
"ppt-count-text")};a.graph.node.updateElements=function(){a.graph.node.svgNodeElements.attr("id",function(a){return"popoto-gnode_"+a.id});a.graph.node.svgNodeElements.selectAll("title").text(function(b){return a.provider.getSemanticValue(b)});a.graph.node.svgNodeElements.filter(function(b){return b.type!==a.graph.node.NodeTypes.ROOT}).call(a.graph.force.drag);a.graph.node.updateBackgroundElements();a.graph.node.updateMiddlegroundElements();a.graph.node.updateForegroundElements()};a.graph.node.updateBackgroundElements=
function(){};a.graph.node.updateMiddlegroundElements=function(){a.graph.node.svgNodeElements.selectAll(".ppt-g-node-middleground").filter(function(b){return a.provider.getNodeDisplayType(b)===a.provider.NodeDisplayTypes.IMAGE}).selectAll(".ppt-node-image").attr("width",function(b){return a.provider.getImageWidth(b)}).attr("height",function(b){return a.provider.getImageHeight(b)}).attr("transform",function(b){return"translate("+-a.provider.getImageWidth(b)/2+","+-a.provider.getImageHeight(b)/2+")"}).attr("xlink:href",
function(b){return a.provider.getImagePath(b)});a.graph.node.svgNodeElements.selectAll(".ppt-g-node-middleground").filter(function(b){return a.provider.getNodeDisplayType(b)===a.provider.NodeDisplayTypes.TEXT}).selectAll("ellipse").attr("class",function(b){if(b.type===a.graph.node.NodeTypes.ROOT)return b.value?"ppt-node-ellipse value":"ppt-node-ellipse root";if(b.type===a.graph.node.NodeTypes.CHOOSE)return b.value?"ppt-node-ellipse value":"ppt-node-ellipse choose";if(b.type===a.graph.node.NodeTypes.VALUE)return"ppt-node-ellipse value";
if(b.type===a.graph.node.NodeTypes.GROUP)return"ppt-node-ellipse group"});var b=a.graph.node.svgNodeElements.selectAll(".ppt-g-node-middleground").filter(function(b){return a.provider.getNodeDisplayType(b)===a.provider.NodeDisplayTypes.SVG}).select("g").selectAll("path").data(function(b){return a.provider.getSVGPaths(b)});b.exit().remove();b.enter().append("path");a.graph.node.svgNodeElements.selectAll(".ppt-g-node-middleground").selectAll("path").attr("d",function(a){return a.d}).attr("class",function(a){return a["class"]});
a.graph.node.svgNodeElements.selectAll(".ppt-g-node-middleground").filter(function(b){return a.provider.isTextDisplayed(b)}).selectAll("text").attr("class",function(b){switch(b.type){case a.graph.node.NodeTypes.CHOOSE:return"ppt-node-text-choose";case a.graph.node.NodeTypes.GROUP:return"ppt-node-text-group";case a.graph.node.NodeTypes.ROOT:return"ppt-node-text-root";case a.graph.node.NodeTypes.VALUE:return"ppt-node-text-value"}}).text(function(b){return a.provider.getTextValue(b)})};a.graph.node.updateForegroundElements=
function(){var b=a.graph.node.svgNodeElements.selectAll(".ppt-g-node-foreground").selectAll(".ppt-node-foreground-g-arrows");b.classed("active",function(b){return b.valueExpanded&&b.data&&b.data.length>a.graph.node.PAGE_SIZE});b.selectAll(".ppt-larrow").classed("enabled",function(a){return 1<a.page});b.selectAll(".ppt-rarrow").classed("enabled",function(b){return b.data?b.page*a.graph.node.PAGE_SIZE<b.data.length:!1});b=a.graph.node.svgNodeElements.selectAll(".ppt-g-node-foreground");b.selectAll(".ppt-count-box").filter(function(b){return b.type!==
a.graph.node.NodeTypes.CHOOSE}).classed("root",!0);b.selectAll(".ppt-count-box").filter(function(b){return b.type===a.graph.node.NodeTypes.CHOOSE}).classed("value",!0);b.selectAll(".ppt-count-text").text(function(a){return null!=a.count?a.count:"..."})};a.graph.node.mouseOverNode=function(){d3.event.preventDefault();if(a.queryviewer.isActive){var b=d3.select(this).data()[0];a.queryviewer.queryConstraintSpanElements.filter(function(a){return a.ref===b}).classed("hover",!0);a.queryviewer.querySpanElements.filter(function(a){return a.ref===
b}).classed("hover",!0)}};a.graph.node.mouseOutNode=function(){d3.event.preventDefault();if(a.queryviewer.isActive){var b=d3.select(this).data()[0];a.queryviewer.queryConstraintSpanElements.filter(function(a){return a.ref===b}).classed("hover",!1);a.queryviewer.querySpanElements.filter(function(a){return a.ref===b}).classed("hover",!1)}};a.graph.node.nodeClick=function(){var b=d3.select(this).data()[0];a.logger.debug("nodeClick ("+b.label+")");if(b.type===a.graph.node.NodeTypes.VALUE)a.graph.node.valueNodeClick(b);
else if(b.type===a.graph.node.NodeTypes.CHOOSE||b.type===a.graph.node.NodeTypes.ROOT)b.valueExpanded?a.graph.node.collapseNode(b):a.graph.node.chooseNodeClick(b)};a.graph.node.collapseNode=function(b){if(b.valueExpanded){a.logger.debug("collapseNode ("+b.label+")");var c=a.graph.force.links().filter(function(c){return c.source===b&&c.type===a.graph.link.LinkTypes.VALUE});c.forEach(function(b){a.graph.force.nodes().splice(a.graph.force.nodes().indexOf(b.target),1)});for(var d=a.graph.force.links().length-
1;0<=d;d--)0<=c.indexOf(a.graph.force.links()[d])&&a.graph.force.links().splice(d,1);b.type!==a.graph.node.NodeTypes.ROOT&&(b.fixed=!1);b.parent&&b.parent.type!==a.graph.node.NodeTypes.ROOT&&(b.parent.fixed=!1);b.valueExpanded=!1;a.update()}else a.logger.debug("collapseNode called on an unexpanded node")};a.graph.node.valueNodeClick=function(b){a.logger.debug("valueNodeClick ("+b.label+")");b.parent.value=b;a.result.hasChanged=!0;a.graph.hasGraphChanged=!0;a.graph.node.collapseNode(b.parent)};a.graph.node.chooseNodeClick=
function(b){a.logger.debug("chooseNodeClick ("+b.label+") with waiting state set to "+a.graph.node.chooseWaiting);if(!a.graph.node.chooseWaiting){a.graph.force.nodes().forEach(function(b){b.type!=a.graph.node.NodeTypes.ROOT&&b.type!=a.graph.node.NodeTypes.CHOOSE||!b.valueExpanded||a.graph.node.collapseNode(b)});var c=a.query.generateValueQuery(b);a.logger.info("Values ("+b.label+") ==> "+c);a.graph.node.chooseWaiting=!0;$.post(a.rest.CYPHER_URL,{query:c,params:{}},"json").done(function(c){b.id=++a.graph.node.idgen;
b.data=a.graph.node.parseResultData(c);b.page=1;a.graph.node.expandNode(b);a.graph.node.chooseWaiting=!1}).fail(function(b,c,f){a.graph.node.chooseWaiting=!1;a.logger.error(c+': error while accessing Neo4j server on URL:"'+a.rest.CYPHER_URL+'" defined in "popoto.rest.CYPHER_URL" property: '+f)})}};a.graph.node.parseResultData=function(a){for(var c=[],d=0;d<a.data.length;d++){for(var e={},f=0;f<a.columns.length;f++)e[a.columns[f]]=a.data[d][f];c.push(e)}return c};a.graph.computeParentAngle=function(a){var c=
0;if(a.parent){var c=a.parent.x,d=a.parent.y,e=a.x;a=a.y;var f=100/(Math.sqrt(Math.pow(c-e,2)+Math.pow(d-a,2))-100),c=Math.acos(((e+f*c)/(1+f)-e)/100);d>a&&(c=2*Math.PI-c)}return c};a.graph.node.expandNode=function(b){var c=b.page*a.graph.node.PAGE_SIZE,d=b.data.slice(c-a.graph.node.PAGE_SIZE,c),e=a.graph.computeParentAngle(b),f=1;d.forEach(function(c){var g;g=b.parent?360/(d.length+1)*f:360/d.length*f;var k=b.x+100*Math.cos(Math.PI/180*g-e);g=b.y+100*Math.sin(Math.PI/180*g-e);c={id:++a.graph.node.idgen,
parent:b,attributes:c,type:a.graph.node.NodeTypes.VALUE,label:b.label,count:c.count,x:k,y:g,internalID:c[a.query.NEO4J_INTERNAL_ID.queryInternalName]};a.graph.force.nodes().push(c);a.graph.force.links().push({id:"l"+ ++a.graph.node.idgen,source:b,target:c,type:a.graph.link.LinkTypes.VALUE});f++});b.fixed=!0;b.parent&&b.parent.type!==a.graph.node.NodeTypes.ROOT&&(b.parent.fixed=!0);b.valueExpanded=!0;a.update()};a.graph.node.rightClickNode=function(){d3.event.preventDefault();var b=d3.select(this).data()[0];
a.graph.force.nodes().forEach(function(b){b.type!==a.graph.node.NodeTypes.CHOOSE&&b.type!==a.graph.node.NodeTypes.ROOT||!b.valueExpanded||a.graph.node.collapseNode(b)});if(b.linkExpanded||a.graph.node.linkWaiting)null==b.value||b.valueExpanded||(delete b.value,a.result.hasChanged=!0,a.graph.hasGraphChanged=!0,a.update());else{a.graph.node.linkWaiting=!0;var c=a.query.generateLinkQuery(b);a.logger.info("Relations ("+b.label+") ==> "+c);$.post(a.rest.CYPHER_URL,{query:c,params:{}},"json").done(function(c){var e=
a.graph.node.parseResultData(c);if(0>=e.length)b.linkExpanded=!0,null==b.value||b.valueExpanded||(delete b.value,a.result.hasChanged=!0,a.graph.hasGraphChanged=!0,a.update());else{var f=a.graph.computeParentAngle(b),h=1;e.forEach(function(c){var d;d=f?360/(e.length+1)*h:360/e.length*h;var l=b.x+100*Math.cos(Math.PI/180*d-f);d=b.y+100*Math.sin(Math.PI/180*d-f);var p=a.provider.getIsGroup(c),l={id:""+ ++a.graph.node.idgen,parent:b,type:p?a.graph.node.NodeTypes.GROUP:a.graph.node.NodeTypes.CHOOSE,label:c.label,
fixed:!1,internalLabel:a.graph.node.generateInternalLabel(c.label),x:l,y:d};a.graph.force.nodes().push(l);a.graph.force.links().push({id:"l"+ ++a.graph.node.idgen,source:b,target:l,type:a.graph.link.LinkTypes.RELATION,label:c.relationship});h++});a.graph.hasGraphChanged=!0;b.linkExpanded=!0;a.update()}a.graph.node.linkWaiting=!1}).fail(function(b,c,f){a.logger.error(c+': error while accessing Neo4j server on URL:"'+a.rest.CYPHER_URL+'" defined in "popoto.rest.CYPHER_URL" property: '+f);a.graph.node.linkWaiting=
!1})}};a.queryviewer={};a.queryviewer.containerId="popoto-query";a.queryviewer.QUERY_STARTER="I'm looking for";a.queryviewer.createQueryArea=function(){var b="#"+a.queryviewer.containerId;a.queryviewer.queryConstraintSpanElements=d3.select(b).append("p").attr("class","ppt-query-constraint-elements").selectAll(".queryConstraintSpan");a.queryviewer.querySpanElements=d3.select(b).append("p").attr("class","ppt-query-elements").selectAll(".querySpan")};a.queryviewer.updateQuery=function(){a.queryviewer.queryConstraintSpanElements=
a.queryviewer.queryConstraintSpanElements.data([]);a.queryviewer.querySpanElements=a.queryviewer.querySpanElements.data([]);a.queryviewer.queryConstraintSpanElements.exit().remove();a.queryviewer.querySpanElements.exit().remove();a.queryviewer.queryConstraintSpanElements=a.queryviewer.queryConstraintSpanElements.data(a.queryviewer.generateConstraintData(a.graph.force.links(),a.graph.force.nodes()));a.queryviewer.querySpanElements=a.queryviewer.querySpanElements.data(a.queryviewer.generateData(a.graph.force.links(),
a.graph.force.nodes()));a.queryviewer.queryConstraintSpanElements.enter().append("span").on("contextmenu",a.queryviewer.rightClickSpan).on("click",a.queryviewer.clickSpan).on("mouseover",a.queryviewer.mouseOverSpan).on("mouseout",a.queryviewer.mouseOutSpan);a.queryviewer.querySpanElements.enter().append("span").on("contextmenu",a.queryviewer.rightClickSpan).on("click",a.queryviewer.clickSpan).on("mouseover",a.queryviewer.mouseOverSpan).on("mouseout",a.queryviewer.mouseOutSpan);a.queryviewer.queryConstraintSpanElements.attr("id",
function(a){return a.id}).attr("class",function(b){return b.isLink?"ppt-span-link":b.type===a.graph.node.NodeTypes.ROOT?"ppt-span-root":b.type===a.graph.node.NodeTypes.CHOOSE?b.ref.value?"ppt-span-value":"ppt-span-choose":b.type===a.graph.node.NodeTypes.VALUE?"ppt-span-value":b.type===a.graph.node.NodeTypes.GROUP?"ppt-span-group":"ppt-span"}).text(function(a){return a.term+" "});a.queryviewer.querySpanElements.attr("id",function(a){return a.id}).attr("class",function(b){return b.isLink?"ppt-span-link":
b.type===a.graph.node.NodeTypes.ROOT?"ppt-span-root":b.type===a.graph.node.NodeTypes.CHOOSE?b.ref.value?"ppt-span-value":"ppt-span-choose":b.type===a.graph.node.NodeTypes.VALUE?"ppt-span-value":b.type===a.graph.node.NodeTypes.GROUP?"ppt-span-group":"ppt-span"}).text(function(a){return a.term+" "})};a.queryviewer.generateConstraintData=function(b,c){var d=[],e=0;d.push({id:e++,term:a.queryviewer.QUERY_STARTER});0<c.length&&d.push({id:e++,type:c[0].type,term:a.provider.getSemanticValue(c[0]),ref:c[0]});
b.forEach(function(b){var c=b.source,g=b.target;b.type===a.graph.link.LinkTypes.RELATION&&g.type!==a.graph.node.NodeTypes.GROUP&&g.value&&(c.type===a.graph.node.NodeTypes.GROUP&&d.push({id:e++,type:c.type,term:a.provider.getSemanticValue(c),ref:c}),d.push({id:e++,isLink:!0,term:a.provider.getLinkSemanticValue(b),ref:b}),g.type!==a.graph.node.NodeTypes.GROUP&&(g.value?d.push({id:e++,type:g.type,term:a.provider.getSemanticValue(g),ref:g}):d.push({id:e++,type:g.type,term:"<choose "+a.provider.getSemanticValue(g)+
">",ref:g})))});return d};a.queryviewer.generateData=function(b,c){var d=[],e=[],f=0;b.forEach(function(b){var c=b.source,k=b.target;k.type===a.graph.node.NodeTypes.GROUP&&e.push({id:f++,type:k.type,term:a.provider.getSemanticValue(k),ref:k});b.type!==a.graph.link.LinkTypes.RELATION||k.type===a.graph.node.NodeTypes.GROUP||k.value||(c.type===a.graph.node.NodeTypes.GROUP&&d.push({id:f++,type:c.type,term:a.provider.getSemanticValue(c),ref:c}),d.push({id:f++,isLink:!0,term:a.provider.getLinkSemanticValue(b),
ref:b}),k.type!==a.graph.node.NodeTypes.GROUP&&(k.value?d.push({id:f++,type:k.type,term:a.provider.getSemanticValue(k),ref:k}):d.push({id:f++,type:k.type,term:"<choose "+a.provider.getSemanticValue(k)+">",ref:k})))});return d.concat(e)};a.queryviewer.mouseOverSpan=function(){d3.select(this).classed("hover",function(a){return a.ref});var b=d3.select(this).data()[0];if(b.ref){var c=a.graph.svg.selectAll("#"+a.graph.link.gID+" > g").filter(function(a){return a===b.ref});c.select("path").classed("ppt-link-hover",
!0);c.select("text").classed("ppt-link-hover",!0);a.graph.svg.selectAll("#"+a.graph.node.gID+" > g").filter(function(a){return a===b.ref}).select(".ppt-g-node-background").selectAll("circle").transition().style("fill-opacity",.5)}};a.queryviewer.rightClickSpan=function(){var b=d3.select(this).data()[0];if(!b.isLink&&b.ref){var c=a.graph.svg.selectAll("#"+a.graph.node.gID+" > g").filter(function(a){return a===b.ref});c.on("contextmenu").call(c.node(),b.ref)}};a.queryviewer.clickSpan=function(){var b=
d3.select(this).data()[0];if(!b.isLink&&b.ref){var c=a.graph.svg.selectAll("#"+a.graph.node.gID+" > g").filter(function(a){return a===b.ref});c.on("click").call(c.node(),b.ref)}};a.queryviewer.mouseOutSpan=function(){d3.select(this).classed("hover",!1);var b=d3.select(this).data()[0];if(b.ref){var c=a.graph.svg.selectAll("#"+a.graph.link.gID+" > g").filter(function(a){return a===b.ref});c.select("path").classed("ppt-link-hover",!1);c.select("text").classed("ppt-link-hover",!1);a.graph.svg.selectAll("#"+
a.graph.node.gID+" > g").filter(function(a){return a===b.ref}).select(".ppt-g-node-background").selectAll("circle").transition().style("fill-opacity",0)}};a.cypherviewer={};a.cypherviewer.containerId="popoto-cypher";a.query={};a.query.RESULTS_PAGE_SIZE=100;a.query.VALUE_QUERY_LIMIT=1E3;a.query.NEO4J_INTERNAL_ID=Object.freeze({queryInternalName:"NEO4JID"});a.query.generateTaxonomyCountQuery=function(b){var c=a.provider.getConstraintAttribute(b);return c===a.query.NEO4J_INTERNAL_ID?"match (n:`"+b+"`) return count(DISTINCT ID(n))":
"match (n:`"+b+"`) return count(DISTINCT n."+c+")"};a.query.generateQueryElements=function(b,c,d,e){var f=[],h=[];if(b.value&&e){var g=a.provider.getConstraintAttribute(b.label);g===a.query.NEO4J_INTERNAL_ID?(f.push("("+b.internalLabel+":`"+b.label+"`)"),h.push("ID("+b.internalLabel+") = "+b.value.internalID)):f.push("("+b.internalLabel+":`"+b.label+"`{`"+g+'`:"'+b.value.attributes[g]+'"})')}else f.push("("+b.internalLabel+":`"+b.label+"`)");d.forEach(function(b){var d=b.source,g=b.target;if(g.value&&
g!==c&&e){var m=a.provider.getConstraintAttribute(g.label),n=g.value.attributes[m];m===a.query.NEO4J_INTERNAL_ID?(f.push("("+d.internalLabel+":`"+d.label+"`)-[:`"+b.label+"`]->("+g.internalLabel+":`"+g.label+"`)"),h.push("ID("+g.internalLabel+") = "+g.value.internalID)):"boolean"===typeof n||"number"===typeof n?f.push("("+d.internalLabel+":`"+d.label+"`)-[:`"+b.label+"`]->("+g.internalLabel+":`"+g.label+"`{`"+m+"`:"+n+"})"):f.push("("+d.internalLabel+":`"+d.label+"`)-[:`"+b.label+"`]->("+g.internalLabel+
":`"+g.label+"`{`"+m+'`:"'+n+'"})')}else f.push("("+d.internalLabel+":`"+d.label+"`)-[:`"+b.label+"`]->("+g.internalLabel+":`"+g.label+"`)")});return{matchElements:f,whereElements:h}};a.query.getRelevantLinks=function(a,c,d){var e=d.slice(),f=[],h=[];e.forEach(function(a){(a.target.value||a.target===c)&&f.push(a)});f.forEach(function(a){e.splice(e.indexOf(a),1)});f.forEach(function(c){var d=c.source;for(c=!0;c;){var f=null;e.forEach(function(a){a.target===d&&(f=a)});null===f?c=!1:f.source===a?(h.push(f),
e.splice(e.indexOf(f),1),c=!1):(h.push(f),e.splice(e.indexOf(f),1),d=f.source)}});return f.concat(h)};a.query.getLinksToRoot=function(b,c){for(var d=[],e=b;e!==a.graph.getRootNode();){for(var f,h=0;h<c.length;h++){var g=c[h];if(g.target===e){f=g;break}}f&&(d.push(f),e=f.source)}return d};a.query.generateLinkQuery=function(b){var c=a.query.getLinksToRoot(b,a.graph.force.links()),c=a.query.generateQueryElements(a.graph.getRootNode(),b,c,!1).matchElements,d=[],e=[];c.push("("+b.internalLabel+":`"+b.label+
"`)-[r]->(x)");d.push("type(r) AS relationship");d.push('reduce(l="", n IN labels(x) | n) AS label');d.push("count(r) AS count");e.push("ORDER BY count(r) DESC");return"MATCH "+c.join(", ")+" RETURN "+d.join(", ")+" "+e.join(" ")};a.query.generateResultCypherQuery=function(){var b=a.graph.getRootNode(),c=a.query.generateQueryElements(b,b,a.query.getRelevantLinks(b,b,a.graph.force.links()),!0),d=c.matchElements,e=[],c=c.whereElements,f=[];f.push("LIMIT "+a.query.RESULTS_PAGE_SIZE);for(var h=a.provider.getReturnAttributes(b.label),
g=a.provider.getConstraintAttribute(b.label),k=0;k<h.length;k++){var l=h[k];l===a.query.NEO4J_INTERNAL_ID?l==g?e.push("ID("+b.internalLabel+") AS "+a.query.NEO4J_INTERNAL_ID.queryInternalName):e.push("COLLECT(DISTINCT ID("+b.internalLabel+")) AS "+a.query.NEO4J_INTERNAL_ID.queryInternalName):l==g?e.push(b.internalLabel+"."+l+" AS "+l):e.push("COLLECT(DISTINCT "+b.internalLabel+"."+l+") AS "+l)}return"MATCH "+d.join(", ")+(0<c.length?" WHERE "+c.join(" AND "):"")+" RETURN DISTINCT "+e.join(", ")+" "+
f.join(" ")};a.query.generateResultCypherQueryCount=function(){var b=a.graph.getRootNode(),c=a.query.generateQueryElements(b,b,a.query.getRelevantLinks(b,b,a.graph.force.links()),!0),d=a.provider.getConstraintAttribute(b.label),e=c.matchElements,f=[],c=c.whereElements;d===a.query.NEO4J_INTERNAL_ID?f.push("count(DISTINCT ID("+b.internalLabel+")) AS count"):f.push("count(DISTINCT "+b.internalLabel+"."+d+") AS count");return"MATCH "+e.join(", ")+(0<c.length?" WHERE "+c.join(" AND "):"")+" RETURN "+f.join(", ")+
" "};a.query.generateNodeCountCypherQuery=function(b){var c=a.query.generateQueryElements(a.graph.getRootNode(),b,a.query.getRelevantLinks(a.graph.getRootNode(),b,a.graph.force.links()),!0),d=c.matchElements,c=c.whereElements,e=[],f=a.provider.getConstraintAttribute(b.label);f===a.query.NEO4J_INTERNAL_ID?e.push("count(DISTINCT ID("+b.internalLabel+"))"):e.push("count(DISTINCT "+b.internalLabel+"."+f+")");return"MATCH "+d.join(", ")+(0<c.length?" WHERE "+c.join(" AND "):"")+" RETURN "+e.join(", ")};
a.query.generateValueQuery=function(b){var c=a.graph.getRootNode(),d=a.query.generateQueryElements(c,b,a.query.getRelevantLinks(c,b,a.graph.force.links()),!0),e=d.matchElements,f=[],d=d.whereElements,h=[];f.push("ORDER BY count DESC LIMIT "+a.query.VALUE_QUERY_LIMIT);for(var g=a.provider.getReturnAttributes(b.label),k=a.provider.getConstraintAttribute(b.label),l=0;l<g.length;l++)g[l]===a.query.NEO4J_INTERNAL_ID?g[l]==k?h.push("ID("+b.internalLabel+") AS "+a.query.NEO4J_INTERNAL_ID.queryInternalName):
h.push("COLLECT (DISTINCT ID("+b.internalLabel+")) AS id"):g[l]==k?h.push(b.internalLabel+"."+g[l]+" AS "+g[l]):h.push("COLLECT(DISTINCT "+b.internalLabel+"."+g[l]+") AS "+g[l]);b=a.provider.getConstraintAttribute(c.label);b===a.query.NEO4J_INTERNAL_ID?h.push("count(DISTINCT ID("+c.internalLabel+")) AS count"):h.push("count(DISTINCT "+c.internalLabel+"."+b+") AS count");return"MATCH "+e.join(", ")+(0<d.length?" WHERE "+d.join(" AND "):"")+" RETURN DISTINCT "+h.join(", ")+" "+f.join(" ")};a.result=
{};a.result.containerId="popoto-results";a.result.hasChanged=!0;a.result.resultCountListeners=[];a.result.resultListeners=[];a.result.onTotalResultCount=function(b){a.result.resultCountListeners.push(b)};a.result.onResultReceived=function(b){a.result.resultListeners.push(b)};a.result.parseResultData=function(b){for(var c=[],d=0;d<b.data.length;d++){for(var e={resultIndex:d,label:a.graph.getRootNode().label,attributes:{}},f=0;f<b.columns.length;f++)e.attributes[b.columns[f]]=""+b.data[d][f];c.push(e)}return c};
a.result.updateResults=function(){if(a.result.hasChanged){var b=a.query.generateResultCypherQuery();a.cypherviewer.isActive&&d3.select("#"+a.cypherviewer.containerId).text(b.split("RETURN")[0]+" RETURN "+a.graph.getRootNode().internalLabel);a.logger.info("Results ==> "+b);$.post(a.rest.CYPHER_URL,{query:b,params:{}},"json").done(function(b){var d=a.result.parseResultData(b);a.result.resultListeners.forEach(function(a){a(d)});a.result.isActive&&(b=d3.select("#"+a.result.containerId).selectAll(".ppt-result").data([]),
b.exit().remove(),b=d3.select("#"+a.result.containerId).selectAll(".ppt-result").data(d,function(a){return a.resultIndex}),b.enter().append("p").attr("class","ppt-result").attr("id",function(a){return"popoto-result-"+a.resultIndex}).each(function(b){a.provider.getDisplayResultFunction(b.label)(d3.select(this))}));a.result.hasChanged=!1}).fail(function(b,d,e){a.logger.error(d+': error while accessing Neo4j server on URL:"'+a.rest.CYPHER_URL+'" defined in "popoto.rest.CYPHER_URL" property: '+e);a.result.resultListeners.forEach(function(a){a([])})});
0<a.result.resultCountListeners.length&&(b=a.query.generateResultCypherQueryCount(),a.logger.info("Count Results ==> "+b),$.post(a.rest.CYPHER_URL,{query:b,params:{}},"json").done(function(b){var d=b.data[b.columns.indexOf("count")];a.result.resultCountListeners.forEach(function(a){a(d)})}).fail(function(b,d,e){a.logger.error(d+': error while accessing Neo4j server on URL:"'+a.rest.CYPHER_URL+'" defined in "popoto.rest.CYPHER_URL" property: '+e);a.result.resultCountListeners.forEach(function(a){a(0)})}))}};
a.provider={};a.provider.linkProvider={};a.provider.nodeProviders={};a.provider.getLinkTextValue=function(b){if(a.provider.linkProvider.hasOwnProperty("getLinkTextValue"))return a.provider.linkProvider.getLinkTextValue(b);if(a.provider.DEFAULT_LINK_PROVIDER.hasOwnProperty("getLinkTextValue"))return a.provider.DEFAULT_LINK_PROVIDER.getLinkTextValue(b);a.logger.error("No provider defined for getLinkTextValue")};a.provider.getLinkSemanticValue=function(b){if(a.provider.linkProvider.hasOwnProperty("getLinkSemanticValue"))return a.provider.linkProvider.getLinkSemanticValue(b);
if(a.provider.DEFAULT_LINK_PROVIDER.hasOwnProperty("getLinkSemanticValue"))return a.provider.DEFAULT_LINK_PROVIDER.getLinkSemanticValue(b);a.logger.error("No provider defined for getLinkSemanticValue")};a.provider.DEFAULT_LINK_PROVIDER=Object.freeze({getLinkTextValue:function(b){return b.type===a.graph.link.LinkTypes.VALUE?a.provider.isTextDisplayed(b.target)?"":a.provider.getTextValue(b.target):b.label},getLinkSemanticValue:function(b){return a.provider.getLinkTextValue(b)}});a.provider.linkProvider=
a.provider.DEFAULT_LINK_PROVIDER;a.provider.NodeDisplayTypes=Object.freeze({TEXT:0,IMAGE:1,SVG:2});a.provider.getProvider=function(b){if(void 0===b)a.logger.error("Node label is undefined, no label provider can be found.");else{if(!a.provider.nodeProviders.hasOwnProperty(b)){a.logger.debug("No direct provider found for label "+b);for(var c in a.provider.nodeProviders)if(a.provider.nodeProviders.hasOwnProperty(c)){var d=a.provider.nodeProviders[c];if(d.hasOwnProperty("children")&&-1<d.children.indexOf(b)){a.logger.debug("No provider is defined for label ("+
b+"), parent ("+c+") will be used");c={parent:c};for(var e in d)d.hasOwnProperty(e)&&"children"!=e&&"parent"!=e&&(c[e]=d[e]);a.provider.nodeProviders[b]=c;return a.provider.nodeProviders[b]}}a.logger.debug("No label provider defined for label ("+b+") default one will be created from popoto.provider.DEFAULT_PROVIDER");a.provider.nodeProviders[b]={};for(var f in a.provider.DEFAULT_PROVIDER)a.provider.DEFAULT_PROVIDER.hasOwnProperty(f)&&(a.provider.nodeProviders[b][f]=a.provider.DEFAULT_PROVIDER[f])}return a.provider.nodeProviders[b]}};
a.provider.getProperty=function(b,c){var d=a.provider.getProvider(b);if(!d.hasOwnProperty(c)){for(var e=d,f=!1;e.hasOwnProperty("parent")&&!f;)e=a.provider.getProvider(e.parent),e.hasOwnProperty(c)&&(d[c]=e[c],f=!0);f||(a.logger.debug('No "'+c+'" property found for node label provider ('+b+"), default value will be used"),a.provider.DEFAULT_PROVIDER.hasOwnProperty(c)?d[c]=a.provider.DEFAULT_PROVIDER[c]:a.logger.error('No default value for "'+c+'" property found for label provider ('+b+")"))}return d[c]};
a.provider.getIsSearchable=function(b){return a.provider.getProperty(b,"isSearchable")};a.provider.getReturnAttributes=function(b){var c=a.provider.getProvider(b);b={};var d=!1;if(c.hasOwnProperty("returnAttributes"))for(var e=0;e<c.returnAttributes.length;e++)c.returnAttributes[e]===a.query.NEO4J_INTERNAL_ID?d=!0:b[c.returnAttributes[e]]=!0;for(;c.hasOwnProperty("parent");)if(c=a.provider.getProvider(c.parent),c.hasOwnProperty("returnAttributes"))for(e=0;e<c.returnAttributes.length;e++)c.returnAttributes[e]===
a.query.NEO4J_INTERNAL_ID?d=!0:b[c.returnAttributes[e]]=!0;if(a.provider.DEFAULT_PROVIDER.hasOwnProperty("returnAttributes"))for(c=0;c<a.provider.DEFAULT_PROVIDER.returnAttributes.length;c++)a.provider.DEFAULT_PROVIDER.returnAttributes[c]===a.query.NEO4J_INTERNAL_ID?d=!0:b[a.provider.DEFAULT_PROVIDER.returnAttributes[c]]=!0;c=[];d&&c.push(a.query.NEO4J_INTERNAL_ID);for(attr in b)b.hasOwnProperty(attr)&&c.push(attr);return c};a.provider.getConstraintAttribute=function(b){return a.provider.getProperty(b,
"constraintAttribute")};a.provider.getTextValue=function(b){return a.provider.getProperty(b.label,"getTextValue")(b)};a.provider.getTextValue=function(b){return a.provider.getProperty(b.label,"getTextValue")(b)};a.provider.getSemanticValue=function(b){return a.provider.getProperty(b.label,"getSemanticValue")(b)};a.provider.getSVGPaths=function(b){return a.provider.getProperty(b.label,"getSVGPaths")(b)};a.provider.isTextDisplayed=function(b){return a.provider.getProperty(b.label,"getIsTextDisplayed")(b)};
a.provider.getIsGroup=function(b){return a.provider.getProperty(b.label,"getIsGroup")(b)};a.provider.getNodeDisplayType=function(b){return a.provider.getProperty(b.label,"getDisplayType")(b)};a.provider.getImagePath=function(b){return a.provider.getProperty(b.label,"getImagePath")(b)};a.provider.getImageWidth=function(b){return a.provider.getProperty(b.label,"getImageWidth")(b)};a.provider.getImageHeight=function(b){return a.provider.getProperty(b.label,"getImageHeight")(b)};a.provider.getDisplayResultFunction=
function(b){return a.provider.getProperty(b,"displayResults")};a.provider.DEFAULT_PROVIDER=Object.freeze({isSearchable:!0,returnAttributes:[a.query.NEO4J_INTERNAL_ID],constraintAttribute:a.query.NEO4J_INTERNAL_ID,getDisplayType:function(b){return a.provider.NodeDisplayTypes.TEXT},getIsGroup:function(a){return!1},getIsTextDisplayed:function(a){return!0},getTextValue:function(b){var c=a.provider.getProperty(b.label,"constraintAttribute");return(b.type===a.graph.node.NodeTypes.VALUE?c===a.query.NEO4J_INTERNAL_ID?
""+b.internalID:""+b.attributes[c]:void 0===b.value?b.label:c===a.query.NEO4J_INTERNAL_ID?""+b.value.internalID:""+b.value.attributes[c]).substring(0,a.graph.node.NODE_MAX_CHARS)},getSemanticValue:function(b){var c=a.provider.getProperty(b.label,"constraintAttribute");return b.type===a.graph.node.NodeTypes.VALUE?c===a.query.NEO4J_INTERNAL_ID?""+b.internalID:""+b.attributes[c]:void 0===b.value?b.label:c===a.query.NEO4J_INTERNAL_ID?""+b.value.internalID:""+b.value.attributes[c]},getImagePath:function(b){if(b.type===
a.graph.node.NodeTypes.VALUE)return"css/image/node-yellow.png";if(void 0===b.value){if(b.type===a.graph.node.NodeTypes.ROOT)return"css/image/node-blue.png";if(b.type===a.graph.node.NodeTypes.CHOOSE)return"css/image/node-green.png";if(b.type===a.graph.node.NodeTypes.GROUP)return"css/image/node-black.png"}else return"css/image/node-orange.png"},getImageWidth:function(a){return 125},getImageHeight:function(a){return 125},displayResults:function(b){b.append("h3").text(function(b){var d=a.provider.getConstraintAttribute(b.label);
return d===a.query.NEO4J_INTERNAL_ID?b.attributes[a.query.NEO4J_INTERNAL_ID.queryInternalName]:b.attributes[d]})}});return a}();
